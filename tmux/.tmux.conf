# ==============================================================================
# TMUX CONFIGURATION
# ==============================================================================
# Minimal tmux config with vim-tmux-navigator integration
# Prefix: C-a | Reload: C-a r | Splits: C-a \ and C-a -
# Git status: * modified, + staged, ? untracked, x deleted, ! conflicts

# ------------------------------------------------------------------------------
# Core Settings
# ------------------------------------------------------------------------------

# Enable true color support
set -g default-terminal "tmux-256color"

# Change prefix from C-b to C-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# Allow escape sequences to pass through to terminal (for notifications)
set -g allow-passthrough on

# Start window/pane numbering at 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# ------------------------------------------------------------------------------
# Keybindings
# ------------------------------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# Session switcher with fzf
bind C-f run-shell "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\\$\" | fzf --tmux --reverse --header 'Switch session' | xargs tmux switch-client -t"

# Help menu with native tmux display-menu
bind ? display-menu -T "#[align=centre]Keybindings" -x C -y C \
  "Reload config                 C-a r" "" "" \
  "Session switcher              C-a C-f" "" "" \
  "" \
  "Split horizontal              C-a \\\\" "" "" \
  "Split vertical                C-a -" "" "" \
  "" \
  "Resize panes                  C-a hjkl" "" "" \
  "" \
  "Git indicators: * modified, + staged" "" "" \
  "                ? untracked, x deleted, ! conflicts" "" "" \
  "" \
  "TPM: Install plugins          C-a I" "" "" \
  "TPM: Update plugins           C-a U" "" "" \
  "TPM: Uninstall plugins        C-a M-u" "" ""

# Splits (open in current directory)
bind \\ split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'

# Resize panes with hjkl (repeatable)
bind -r h resize-pane -L 8
bind -r j resize-pane -D 4
bind -r k resize-pane -U 4
bind -r l resize-pane -R 8

# Vi copy mode
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi C-v send -X rectangle-toggle
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# ------------------------------------------------------------------------------
# Plugins
# ------------------------------------------------------------------------------
# TPM keybindings:
#   prefix + I       Install new plugins
#   prefix + U       Update plugins
#   prefix + alt + u Remove/uninstall plugins not in list

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'

# ------------------------------------------------------------------------------
# Status Bar
# ------------------------------------------------------------------------------

set -g status-position bottom
set -g status-style "bg=default"

# Left: session name
set -g status-left-length 50
set -g status-left "#[fg=green]\ue795 #[fg=cyan,bold]#S "

# Right: directory + git status
set -g status-right-length 80
set -g status-right "#[fg=blue]Û∞âã #[fg=white]#{b:pane_current_path} #[fg=magenta]#(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD 2>/dev/null)#[fg=yellow]#(cd #{pane_current_path}; git diff --quiet 2>/dev/null || echo '*')#[fg=green]#(cd #{pane_current_path}; git diff --cached --quiet 2>/dev/null || echo '+')#[fg=red]#(cd #{pane_current_path}; [ -n \"\$(git ls-files --others --exclude-standard 2>/dev/null)\" ] && echo '?')#(cd #{pane_current_path}; git status --porcelain 2>/dev/null | grep -q '^ D' && echo 'x')#(cd #{pane_current_path}; git status --porcelain 2>/dev/null | grep -q '^UU' && echo '!')#[fg=green]#(cd #{pane_current_path}; git rev-list --count HEAD@{upstream}..HEAD 2>/dev/null | grep -v '^0$' | sed 's/^/‚Üë/')#[fg=red]#(cd #{pane_current_path}; git rev-list --count HEAD..HEAD@{upstream} 2>/dev/null | grep -v '^0$' | sed 's/^/‚Üì/') #[fg=brightblack]‚îÇ #[fg=white]Help: #[fg=cyan]Prefix + ?"

# Window tabs
set -g window-status-format " #I:#W#{?window_zoomed_flag, üîç,} "
set -g window-status-current-format "#[fg=yellow,bold] #I:#W#{?window_zoomed_flag, üîç,} "
set -g window-status-separator ""

# ------------------------------------------------------------------------------
# Appearance
# ------------------------------------------------------------------------------

# Pane borders
set -g pane-border-style "fg=brightblack"
set -g pane-active-border-style "fg=cyan"

# Message styling
set -g message-style "bg=default,fg=yellow"

# Copy mode highlighting
set-window-option -g mode-style "fg=black,bg=yellow"

# ------------------------------------------------------------------------------
# Initialize TPM (keep at bottom)
# ------------------------------------------------------------------------------

run '~/.tmux/plugins/tpm/tpm'
