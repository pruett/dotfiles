#!/usr/bin/env bash
set -euo pipefail

CLAWDBOT_DIR="/Users/kevinpruett/code/clawdbot"

echo "ðŸ”„ Updating Clawdbot (source install)..."

cd "$CLAWDBOT_DIR"

echo "â†’ Fetching latest..."
git fetch origin

LOCAL=$(git rev-parse HEAD)
REMOTE=$(git rev-parse origin/main)

if [ "$LOCAL" = "$REMOTE" ]; then
    echo "âœ“ Already up to date."
    exit 0
fi

BEHIND=$(git rev-list --count HEAD..origin/main)
echo "â†’ $BEHIND commits behind, pulling..."

git pull origin main

echo "â†’ Installing dependencies..."
bun install

echo "â†’ Building..."
bun run build

echo "â†’ Restarting daemon..."
clawdbot daemon restart || true

echo "âœ… Clawdbot updated successfully."
